<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>Night Games v554</title>
<style>
  :root{
    --bg0:#05070b;
    --bg1:#070b12;
    --blue:#2aa6ff;
    --blue2:#0b3cff;
    --gold:#ffb400;
    --gold2:#ffd36a;
    --green:#25d96b;
    --text:#e9eef7;
    --muted:#9fb0c7;
    --panel: rgba(255,255,255,.04);
    --panel2: rgba(0,0,0,.25);
    --line: rgba(255,255,255,.10);
    --shadow: 0 18px 45px rgba(0,0,0,.6);
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; background: radial-gradient(900px 700px at 22% 10%, rgba(36,255,232,.10), transparent 55%),
                                   radial-gradient(800px 650px at 84% 40%, rgba(255,180,0,.10), transparent 58%),
                                   radial-gradient(700px 650px at 62% 80%, rgba(50,120,255,.12), transparent 56%),
                                   linear-gradient(180deg,var(--bg0),var(--bg1)); color:var(--text); font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
  a{color:inherit}
  .app{min-height:100%; display:flex; flex-direction:column; align-items:center; padding:16px 14px 18px; gap:14px;}
  .topRow{width:min(980px,100%); display:flex; align-items:center; justify-content:space-between; gap:10px;}
  .brand{display:flex; align-items:center; gap:10px;}
  .badge{font-weight:700; letter-spacing:.14em; font-size:12px; color:rgba(233,238,247,.85);
         padding:7px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.25);}
  .badge strong{color:#fff}
  .soundBtn{border:1px solid rgba(255,255,255,.12); background:rgba(0,0,0,.25); color:rgba(233,238,247,.9);
            border-radius:12px; padding:9px 10px; font-weight:700; letter-spacing:.02em; display:flex; gap:8px; align-items:center; cursor:pointer;}
  .soundDot{width:10px; height:10px; border-radius:99px; background:rgba(255,255,255,.22); box-shadow:none;}
  .soundDot.on{background:var(--green); box-shadow:0 0 14px rgba(37,217,107,.55);}
  .screen{width:min(980px,100%); border-radius:22px; padding:14px; background:rgba(0,0,0,.22); border:1px solid rgba(255,255,255,.10); box-shadow: var(--shadow);}
  /* "floating" sections (no solid backgrounds, just glass + glow edges) */
  .float{border-radius:18px; padding:14px; background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
         border:1px solid rgba(255,255,255,.10);}
  .float.nobg{background:transparent; border:none; padding:0;}
  .logoWrap{border-radius:18px; overflow:hidden; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.18);}
  .logoWrap img{width:100%; height:auto; display:block;}
  .titleGlow{text-align:center; margin:10px 0 2px; font-weight:900; letter-spacing:.08em; font-size:38px; line-height:1; 
             background: linear-gradient(180deg, #bfe8ff 0%, #4db7ff 45%, #0b66ff 100%);
             -webkit-background-clip:text; background-clip:text; color:transparent;
             text-shadow: 0 0 18px rgba(42,166,255,.25);}
  .sub{text-align:center; margin:0 0 12px; color:rgba(177,199,227,.95);}
  .sub .v{opacity:.95; color:rgba(42,166,255,.95);}
  .signin{display:flex; flex-direction:column; gap:10px; margin-top:6px;}
  .label{font-weight:900; letter-spacing:.18em; color:var(--green); font-size:18px;}
  .help{color:rgba(233,238,247,.78); margin-top:-6px;}
  .input{width:100%; padding:14px 14px; border-radius:14px; outline:none; color:#0c1119;
         background: linear-gradient(180deg, #fff6cf 0%, #ffeaa8 100%);
         border:2px solid rgba(11,102,255,.65);
         box-shadow: 0 0 0 1px rgba(42,166,255,.20), 0 0 22px rgba(11,102,255,.18); font-size:16px;}
  .btn{width:100%; padding:14px 14px; border-radius:999px; border:1px solid rgba(255,255,255,.18);
       background: radial-gradient(120% 180% at 20% 10%, rgba(255,255,255,.55), rgba(255,255,255,0) 38%),
                   linear-gradient(180deg, #ffeaa8 0%, #ffb400 70%, #e59400 100%);
       color:#1a1200; font-weight:900; letter-spacing:.28em; text-transform:uppercase; cursor:pointer;
       box-shadow: 0 14px 28px rgba(0,0,0,.55), 0 0 22px rgba(255,180,0,.20);}
  .btn:active{transform: translateY(1px);}
  .sparkBar{height:10px; border-radius:999px; margin:12px 0 0;
            background: linear-gradient(90deg, rgba(0,0,0,0), rgba(42,166,255,.55), rgba(255,180,0,.45), rgba(0,0,0,0));
            filter: blur(.1px);
            box-shadow: 0 0 16px rgba(42,166,255,.12), 0 0 18px rgba(255,180,0,.12);}
  .legal{margin-top:14px; padding-top:12px; border-top:1px solid rgba(255,255,255,.08); text-align:center; color:rgba(233,238,247,.85);}
  .legal b{color:#fff}
  /* sweep MP4 overlay */
  .sweep{position:fixed; inset:0; pointer-events:none; display:none; align-items:center; justify-content:center; z-index:9999;}
  .sweep.show{display:flex;}
  .sweep video{width:min(520px, 92vw); transform: rotate(-15deg); opacity:.92; filter: drop-shadow(0 18px 40px rgba(0,0,0,.75));}
  /* pages */
  .page{display:none;}
  .page.active{display:block;}
  /* player page */
  .playerTop{display:flex; align-items:flex-start; justify-content:space-between; gap:10px;}
  .playerName{font-size:34px; font-weight:1000; letter-spacing:.02em; margin:0;}
  .playerEmail{margin:2px 0 0; color:rgba(233,238,247,.70);}
  .pill{border-radius:999px; padding:10px 12px; border:1px solid rgba(255,255,255,.12); background:rgba(0,0,0,.25);
        font-weight:900; letter-spacing:.1em; cursor:pointer;}
  .grid{display:grid; grid-template-columns: 1.25fr .75fr; gap:14px; margin-top:14px;}
  @media (max-width:760px){ .grid{grid-template-columns:1fr;} }
  .card{border-radius:18px; padding:14px; border:1px solid rgba(255,255,255,.10);
        background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));}
  .card h3{margin:0 0 8px; letter-spacing:.10em; text-transform:uppercase; font-size:14px; color:rgba(233,238,247,.82);}
  .gameBtn{width:100%; border-radius:16px; padding:14px; border:1px solid rgba(255,255,255,.12);
          background: radial-gradient(120% 160% at 18% 10%, rgba(42,166,255,.28), rgba(0,0,0,0) 52%),
                      rgba(0,0,0,.25);
          color:rgba(233,238,247,.96); font-weight:900; letter-spacing:.06em; cursor:pointer;}
  .gameBtn small{display:block; margin-top:6px; font-weight:700; letter-spacing:.02em; color:rgba(233,238,247,.70);}
  .playersList{display:flex; flex-direction:column; gap:10px;}
  .pRow{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:12px; border-radius:14px;
        border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.22);}
  .pLeft{display:flex; align-items:center; gap:10px;}
  .online{width:10px; height:10px; border-radius:99px; background:rgba(255,255,255,.18);}
  .online.on{background:var(--green); box-shadow:0 0 16px rgba(37,217,107,.55);}
  .avatar{width:34px; height:34px; border-radius:12px; overflow:hidden; border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.25);}
  .avatar img{width:100%; height:100%; object-fit:cover; display:block;}
  .pName{font-weight:900;}
  .pMeta{color:rgba(233,238,247,.70); font-size:12px;}
  .toast{position:fixed; left:50%; bottom:18px; transform:translateX(-50%); background:rgba(0,0,0,.70); border:1px solid rgba(255,255,255,.12);
         color:#fff; padding:10px 12px; border-radius:12px; display:none; z-index:9998;}
  .toast.show{display:block;}
  /* modal */
  .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.55); z-index:9997; padding:16px;}
  .modal.show{display:flex;}
  .modalBox{width:min(520px, 100%); border-radius:18px; padding:14px; border:1px solid rgba(255,255,255,.12); background:rgba(6,10,18,.92); box-shadow: var(--shadow);}
  .modalBox h2{margin:4px 0 8px; font-size:20px;}
  .row{display:flex; gap:10px; margin-top:10px;}
  .row .btn{letter-spacing:.16em;}
  .btn.secondary{background:rgba(255,255,255,.06); color:#fff; box-shadow:none;}
</style>
</head>
<body>
<div class="sweep" id="sweep">
  <video id="sweepVid" muted playsinline preload="auto"></video>
</div>

<div class="app">
  <div class="topRow">
    <div class="brand">
      <div class="badge"><strong>NIGHT GAMES</strong> • v554</div>
    </div>
    <button class="soundBtn" id="soundBtn" type="button" aria-label="Sound">
      <span class="soundDot" id="soundDot"></span>
      SOUND
    </button>
  </div>

  <div class="screen">
    <!-- LANDING -->
    <section class="page active" id="pageLanding">
      <div class="logoWrap" id="logoWrap">
        <img id="logoImg" alt="Night Games" />
      </div>

      <div class="titleGlow" id="titleMain">Night Games</div>
      <p class="sub" id="subtitle">Enter your email to continue • <span class="v">v554</span></p>

      <div class="signin">
        <div class="label">SIGN IN</div>
        <div class="help">Email only. If you're new, we'll ask your name one time.</div>
        <input class="input" id="emailInput" type="email" inputmode="email" autocomplete="email" placeholder="you@example.com" />
        <button class="btn" id="enterBtn" type="button">Enter</button>
        <div class="sparkBar" id="sparkBar"></div>
      </div>

      <div class="legal">
        Night Games is owned by <b>The Dart Room</b>. © 2026 The Dart Room. All rights reserved. • Designed by <b>Steve's Graphic Designs</b>.
      </div>
    </section>

    <!-- PLAYER PAGE -->
    <section class="page" id="pagePlayer">
      <div class="playerTop">
        <div>
          <h1 class="playerName" id="playerName">Player</h1>
          <div class="playerEmail" id="playerEmail">email</div>
        </div>
        <button class="pill" id="signOutBtn" type="button">SIGN OUT</button>
      </div>

      <div class="grid">
        <div class="card">
          <h3>Games</h3>
          <div style="display:flex; flex-direction:column; gap:10px;">
            <!-- Keep same layout: one segment per game (for future History button) -->
            <button class="gameBtn" type="button" data-game="monkey">MONKEY<small>Play (stub)</small></button>
            <button class="gameBtn" type="button" data-game="cricket">CRICKET<small>Play (stub)</small></button>
            <button class="gameBtn" type="button" data-game="01">01 (301/501/701)<small>Play (stub)</small></button>
            <button class="gameBtn" type="button" data-game="game4">GAME 4<small>Rename later</small></button>
            <button class="gameBtn" type="button" data-game="game5">GAME 5<small>Rename later</small></button>
          </div>
        </div>

        <div class="card">
          <h3>Players (up to 8)</h3>
          <div class="playersList" id="playersList"></div>
        </div>
      </div>

      <div class="legal">
        Night Games is owned by <b>The Dart Room</b>. © 2026 The Dart Room. All rights reserved. • Designed by <b>Steve's Graphic Designs</b>.
      </div>
    </section>
  </div>
</div>

<div class="toast" id="toast"></div>

<div class="modal" id="modal">
  <div class="modalBox">
    <h2>New player</h2>
    <div style="color:rgba(233,238,247,.78)">We don't see that email yet. Enter your name once.</div>
    <input class="input" id="nameInput" type="text" autocomplete="name" placeholder="Your name" style="margin-top:12px"/>
    <div class="row">
      <button class="btn secondary" id="cancelNameBtn" type="button">Cancel</button>
      <button class="btn" id="saveNameBtn" type="button">Save</button>
    </div>
  </div>
</div>

<script>
/**
 * CLEAN REBUILD NOTE:
 * - This file is self-contained UI + routing + localStorage identity only.
 * - Firebase/multiplayer hooks are intentionally stubbed (no patchwork / no conflicting code).
 * - When you're ready, we can swap the storage layer to Firebase without changing the UI flow.
 */

/* ====== CONFIG (edit paths if your repo uses a different folder) ====== */
const CONFIG = {
  version: "v554",
  // Your chosen neon logo banner PNG (you told me it's in your repo):
  logoPath: "7F737C26-56A1-497B-A4A2-CCD6141E7B8C.png",
  // Sweep MP4 (you said there's only one MP4 in repo). Put its filename here if needed:
  sweepMp4Path: "", // example: "intro_sweep.mp4"
  playSweepOnce: true,
  sweepDelayMs: 350,   // logo shows first, then sweep
  sweepShowMs: 1200,   // stays briefly, then disappears
  // Avatars are optional right now. Add your exact filenames later.
  avatarsByEmail: {
    "stevewmoody@yahoo.com": "",  // example: "steve_avatar.png"
  }
};
/* ================================================================ */

const $ = (id)=>document.getElementById(id);

const pages = {
  landing: $("pageLanding"),
  player: $("pagePlayer"),
};

function showPage(which){
  Object.values(pages).forEach(p=>p.classList.remove("active"));
  pages[which].classList.add("active");
  window.scrollTo(0,0);
}

function toast(msg){
  const t=$("toast");
  t.textContent=msg;
  t.classList.add("show");
  clearTimeout(toast._t);
  toast._t=setTimeout(()=>t.classList.remove("show"), 2200);
}

function normalizeEmail(v){
  return (v||"").trim().toLowerCase();
}

function loadUsers(){
  try {
    return JSON.parse(localStorage.getItem("ng_users")||"{}");
  } catch(e){ return {}; }
}

function saveUsers(users){
  localStorage.setItem("ng_users", JSON.stringify(users));
}

function setCurrentEmail(email){
  localStorage.setItem("ng_current_email", email);
}

function getCurrentEmail(){
  return localStorage.getItem("ng_current_email") || "";
}

function clearCurrentEmail(){
  localStorage.removeItem("ng_current_email");
}

function ensureOwnerAccount(){
  // Your permanent fixture exists in the directory, but is NOT auto-added to a match.
  const ownerEmail = "stevewmoody@yahoo.com";
  const ownerName  = "Steve Moody";
  const users = loadUsers();
  if(!users[ownerEmail]) {
    users[ownerEmail] = {
      email: ownerEmail,
      name: ownerName,
      createdAt: Date.now(),
      lastSeenAt: Date.now(),
      online: false
    };
    saveUsers(users);
  }
}
ensureOwnerAccount();

/* ----- assets ----- */
function setLogo(){
  const img = $("logoImg");
  img.src = CONFIG.logoPath;
  img.onerror = ()=>{ img.alt="(logo not found - check CONFIG.logoPath)"; };
}

function runSweep(){
  if(!CONFIG.sweepMp4Path) return;
  const wrap = $("sweep");
  const vid = $("sweepVid");
  vid.src = CONFIG.sweepMp4Path;
  const show = ()=>{ wrap.classList.add("show"); };
  const hide = ()=>{ wrap.classList.remove("show"); };
  const start = ()=>{
    show();
    vid.currentTime = 0;
    const p = vid.play();
    if(p && p.catch) p.catch(()=>{});
    if(CONFIG.playSweepOnce){
      setTimeout(()=>{ hide(); vid.pause(); }, CONFIG.sweepShowMs);
    }
  };
  setTimeout(start, CONFIG.sweepDelayMs);
}

setLogo();
runSweep();

/* ----- sound toggle (stub) ----- */
let soundOn = false;
function setSound(on){
  soundOn = !!on;
  $("soundDot").classList.toggle("on", soundOn);
  // later: wire to actual sound effects
}
$("soundBtn").addEventListener("click", ()=> setSound(!soundOn));

/* ----- landing flow ----- */
const modal = $("modal");
let pendingEmail = "";

function openNameModal(email){
  pendingEmail = email;
  $("nameInput").value = "";
  modal.classList.add("show");
  setTimeout(()=>$("nameInput").focus(), 50);
}
function closeNameModal(){
  modal.classList.remove("show");
  pendingEmail = "";
}

$("cancelNameBtn").addEventListener("click", closeNameModal);
modal.addEventListener("click", (e)=>{ if(e.target===modal) closeNameModal(); });

function routeToPlayer(email){
  setCurrentEmail(email);
  // auto-clear email input so next person doesn't see it
  $("emailInput").value = "";
  showPlayer(email);
}

function showPlayer(email){
  const users = loadUsers();
  const u = users[email];
  if(!u){ showPage("landing"); return; }
  $("playerName").textContent = u.name || "Player";
  $("playerEmail").textContent = u.email;

  // "online" indicator is stubbed (no Firebase presence yet)
  u.lastSeenAt = Date.now();
  u.online = true;
  users[email] = u;
  saveUsers(users);

  renderPlayersList(email);
  showPage("player");
}

function renderPlayersList(currentEmail){
  const users = loadUsers();
  const list = $("playersList");
  const arr = Object.values(users)
    .sort((a,b)=>(b.lastSeenAt||0)-(a.lastSeenAt||0))
    .slice(0,8);

  list.innerHTML = "";
  arr.forEach(u=>{
    const row = document.createElement("div");
    row.className = "pRow";
    const left = document.createElement("div");
    left.className = "pLeft";

    const dot = document.createElement("div");
    dot.className = "online" + (u.online ? " on" : "");
    const av = document.createElement("div");
    av.className = "avatar";
    const img = document.createElement("img");
    img.alt = u.name || "avatar";
    const override = CONFIG.avatarsByEmail[normalizeEmail(u.email)];
    if(override) img.src = override;
    else img.src = ""; // no avatar yet
    img.onerror = ()=>{ av.style.display="none"; };
    av.appendChild(img);

    const metaWrap = document.createElement("div");
    const nm = document.createElement("div");
    nm.className = "pName";
    nm.textContent = u.name || "(no name)";
    const meta = document.createElement("div");
    meta.className = "pMeta";
    meta.textContent = u.email + (u.email===currentEmail ? " • (you)" : "");

    metaWrap.appendChild(nm);
    metaWrap.appendChild(meta);

    left.appendChild(dot);
    left.appendChild(av);
    left.appendChild(metaWrap);

    const right = document.createElement("div");
    right.className = "pMeta";
    right.textContent = "●"; // placeholder for future controls

    row.appendChild(left);
    row.appendChild(right);
    list.appendChild(row);
  });
}

function handleEnter(){
  const email = normalizeEmail($("emailInput").value);
  if(!email || !email.includes("@") || !email.includes(".")) {
    toast("Enter a valid email.");
    return;
  }
  const users = loadUsers();
  if(users[email]) {
    routeToPlayer(email);
    return;
  }
  openNameModal(email);
}

$("enterBtn").addEventListener("click", handleEnter);
$("emailInput").addEventListener("keydown", (e)=>{ if(e.key==="Enter") handleEnter(); });

$("saveNameBtn").addEventListener("click", ()=>{
  const name = ($("nameInput").value||"").trim();
  if(!name){ toast("Enter your name."); return; }
  const email = pendingEmail;
  if(!email){ closeNameModal(); return; }
  const users = loadUsers();
  users[email] = {
    email,
    name,
    createdAt: Date.now(),
    lastSeenAt: Date.now(),
    online: true
  };
  saveUsers(users);
  closeNameModal();
  routeToPlayer(email);
});

/* ----- sign out ----- */
$("signOutBtn").addEventListener("click", ()=>{
  const email = getCurrentEmail();
  const users = loadUsers();
  if(users[email]) {
    users[email].online = false;
    saveUsers(users);
  }
  clearCurrentEmail();
  showPage("landing");
});

/* ----- restore session ----- */
(function boot(){
  const email = getCurrentEmail();
  if(email){
    const users = loadUsers();
    if(users[email]) showPlayer(email);
    else showPage("landing");
  }
})();

/* ----- game buttons (stub) ----- */
document.querySelectorAll(".gameBtn").forEach(btn=>{
  btn.addEventListener("click", ()=> toast("Game screen coming next."));
});
</script>
</body>
</html>
